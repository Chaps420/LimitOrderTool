<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRPL Limit Order Tool</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link rel="stylesheet" href="./src/css/styles.css">
    
    <!-- Load XRPL library from CDN -->
    <script src="https://unpkg.com/xrpl@3.0.0/dist/xrpl-latest-min.js"></script>
    
    <!-- Suppress browser extension console warnings -->
    <script>
        // Suppress common browser extension console warnings
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        console.error = function(...args) {
            const message = args.join(' ');
            if (message.includes('chrome.runtime') || 
                message.includes('isDevEnv()') || 
                message.includes('ethereum.js') ||
                message.includes('trusted site') ||
                message.includes('Pippit') ||
                message.includes('contentScript')) {
                return; // Suppress these specific warnings
            }
            originalConsoleError.apply(console, args);
        };
        
        console.warn = function(...args) {
            const message = args.join(' ');
            if (message.includes('chrome.runtime') || 
                message.includes('isDevEnv()') || 
                message.includes('ethereum.js') ||
                message.includes('trusted site') ||
                message.includes('Pippit') ||
                message.includes('contentScript')) {
                return; // Suppress these specific warnings
            }
            originalConsoleWarn.apply(console, args);
        };
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>XRPL<span class="accent">Trader</span></h1>
                </div>
                <div class="header-actions">
                    <div class="backend-status" id="backend-status">
                        <span class="status-text">Checking mode...</span>
                    </div>
                    <div class="network-status" id="networkStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Connecting...</span>
                    </div>
                    <button class="btn btn-primary" id="connectWallet">
                        Connect Wallet
                    </button>
                    <button class="btn btn-secondary" id="disconnectWallet" style="display: none;">
                        Disconnect
                    </button>
                    <div class="wallet-info" id="walletInfo" style="display: none;">
                        <span class="wallet-address" id="walletAddress"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Hero Section -->
                <section class="hero">
                    <h2>Automated Limit Order Distribution</h2>
                    <p>Create multiple limit sell orders across market cap ranges with a single signature</p>
                </section>

                <!-- Strategy Selector -->
                <section class="strategy-section">
                    <div class="section-header">
                        <h3>Order Strategy</h3>
                    </div>

                    <!-- Market Cap Strategy -->
                    <div class="strategy-content active" id="marketCapStrategy">
                        <div class="card">
                            <div class="card-header">
                                <h4>Distribution Settings</h4>
                            </div>
                            <div class="card-body">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="tokenSelect">Select Token</label>
                                        <select id="tokenSelect" class="form-control">
                                            <option value="">Choose a token...</option>
                                            <option value="custom">Enter Custom Token</option>
                                        </select>
                                        <div class="custom-token-input" id="customTokenInput" style="display: none;">
                                            <input type="text" id="customTokenCode" placeholder="Token Code" class="form-control">
                                            <input type="text" id="customTokenIssuer" placeholder="Token Issuer Address" class="form-control">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="tokenSupply">Token Supply</label>
                                        <input type="number" id="tokenSupply" placeholder="1,000,000,000" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label for="bottomMarketCap">Bottom Market Cap ($)</label>
                                        <input type="number" id="bottomMarketCap" placeholder="1,000,000" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label for="topMarketCap">Top Market Cap ($)</label>
                                        <input type="number" id="topMarketCap" placeholder="10,000,000" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label for="orderCount">Number of Orders</label>
                                        <input type="number" id="orderCount" placeholder="10" min="2" max="50" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label for="totalTokens">Total Token Amount</label>
                                        <input type="number" id="totalTokens" placeholder="1,000,000" class="form-control">
                                    </div>
                                </div>

                                <!-- Distribution Method Selection -->
                                <div class="distribution-method">
                                    <div class="form-group checkbox-group">
                                        <div class="method-description">
                                            <span class="linear-desc">✅ Linear (Default): Evenly spaced price intervals</span>
                                            <span class="logarithmic-desc">📈 Logarithmic: More orders at lower prices</span>
                                        </div>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="useLogarithmic" class="checkbox">
                                            <span class="checkbox-text">Check for Logarithmic Distribution</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button class="btn btn-secondary" id="calculateOrders">Calculate Orders</button>
                                    <button class="btn btn-primary" id="createOrders" disabled>Create Orders</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Order Preview -->
                <section class="preview-section" id="previewSection" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h4>Order Preview</h4>
                            <div class="preview-stats">
                                <span class="stat">
                                    <span class="stat-label">Distribution:</span>
                                    <span class="stat-value" id="distributionType">Linear</span>
                                </span>
                                <span class="stat">
                                    <span class="stat-label">Total Orders:</span>
                                    <span class="stat-value" id="totalOrdersCount">0</span>
                                </span>
                                <span class="stat">
                                    <span class="stat-label">Total XRP Expected:</span>
                                    <span class="stat-value" id="totalXRPExpected">0</span>
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="orders-table-container">
                                <table class="orders-table">
                                    <thead>
                                        <tr>
                                            <th>Order #</th>
                                            <th>Price (XRP)</th>
                                            <th>Amount (Tokens)</th>
                                            <th>Market Cap</th>
                                            <th>Total XRP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersPreviewBody">
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="preview-actions">
                                <button class="btn btn-primary btn-large" id="signTransaction">
                                    Sign Transaction with Xaman
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Transaction Status -->
                <section class="status-section" id="statusSection" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h4>Transaction Status</h4>
                        </div>
                        <div class="card-body">
                            <div class="status-display" id="statusDisplay">
                                <!-- Status updates will appear here -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Wait for XRPL library to load before initializing the app
        async function waitForXRPL() {
            let attempts = 0;
            const maxAttempts = 50; // 5 seconds max wait
            
            while (typeof window.xrpl === 'undefined' && attempts < maxAttempts) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (typeof window.xrpl === 'undefined') {
                console.error('❌ XRPL library failed to load');
                document.body.insertAdjacentHTML('beforeend', 
                    '<div style="position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 1rem; border-radius: 8px; z-index: 9999;">❌ XRPL library failed to load. Please refresh the page.</div>'
                );
            } else {
                console.log('✅ XRPL library loaded successfully');
                console.log('✅ Page loaded, QR code will use fallback API method');
            }
        }
        
        // Start waiting for XRPL library
        waitForXRPL();
    </script>
    <script type="module" src="./src/js/app.js"></script>
</body>
</html>
